import { Component, Input, NgZone, OnDestroy, OnInit, ViewChild } from '@angular/core';
import { catchError, map, Observable, of } from 'rxjs';
import { GoogleMap, MapDirectionsService, MapPolyline } from '@angular/google-maps';
import { HttpClient } from '@angular/common/http';

export interface MapDirectionsResponse {
  status: google.maps.DirectionsStatus;
  result?: google.maps.DirectionsResult;
}

@Component({
  selector: 'app-google-map-custom',
  templateUrl: './google-map-custom.component.html',
  styleUrls: ['./google-map-custom.component.scss'],
})
export class GoogleMapCustomComponent implements OnInit, OnDestroy {
  @Input() height: string = '400px';
  @Input() width: string = '750px';
  @Input() zoom: number = 6;
  @Input() center: google.maps.LatLngLiteral = {lat: 16.743428271879853, lng: 107.29199485264184};
  polylineOptionsList: google.maps.PolylineOptions[] = [];


  constructor(mapDirectionsService: MapDirectionsService, httpClient: HttpClient) {
    const svgMarker = {
      path: "M 65.11562,83.901823 C 64.723,82.097481 64.132583,80.017778 64,78.985635 C 63.353386,73.951805 55.749897,68.642484 41.307465,64.49571 C 36.463359,63.104849 30.773433,61.287338 28.663185,60.456797 C 16.246634,55.569949 12.012848,45.003341 17.5,32.595917 C 18.875,29.486798 20,26.256761 20,25.418058 C 20,22.84036 14.672206,17.083245 12.322804,17.000029 C 8.4760926,16.863778 3.9999996,10.526841 3.9999996,7.7721561 C 3.9999996,5.7090972 8.6423766,5.8979946 12.121889,6.7142755 C 12.121889,6.7142755 16.707686,7.3505404 18.206079,11.77761 C 18.676747,13.168219 18.412174,13.824336 19.365895,15.270318 C 20.319617,16.716299 23.361608,19.088465 24.163516,20.397883 C 26.814759,24.72704 26.639458,28.372353 24.021962,34.140796 C 22.934041,36.538358 22.034041,39.946842 22.021962,41.715204 C 21.992111,46.08534 26.956155,51.569999 33.42393,54.312978 C 36.215768,55.496995 43.326794,58.851934 49.226209,61.768398 C 62.136114,68.150604 64.950124,71.214854 66.183525,80.233673 C 67.134014,87.183804 66.736142,88.550456 65.11562,83.901823 z",
      fillColor: "red",
      fillOpacity: 0.5,
      strokeWeight: 0,
      rotation: 0,
      scale: 0.5,
      anchor: new google.maps.Point(0, 10),
    };
    let polylineOptionsCore = {
      icons: [{
        icon: svgMarker,
        offset: '20%'
      }],
      strokeColor: '1',
      strokeOpacity: 0,
      path: [],
      geodesic: true,
    }
    let paths = [
      {
        id: 1,
        path: [{lat: 10.83681587422422, lng: 106.69123984794433},
          {lat: 11.952749047011816, lng: 108.44108838127723},
          {lat: 13.994761407572653, lng: 108.03098465823884},
          {lat: 15.141416938436706, lng: 108.80816105289705},
          {lat: 15.567281788071831, lng: 108.48102833156065},
          {lat: 16.126750114098915, lng: 108.27017603763079},
          {lat: 16.58167781786605, lng: 107.65662418622229},
          {lat: 16.805138871574268, lng: 107.07715392917399},]
      },
      {
        id: 2,
        path: [{lat: 18.354691459788658, lng: 105.86553435239364},
          {lat: 18.711456424601646, lng: 105.66234345655316},
          {lat: 19.819682361703254, lng: 105.76770166633268},
          {lat: 20.236838859472684, lng: 105.99346928371303},
          {lat: 21.02690476323909, lng: 105.83576193503957},
          {lat: 20.236838859472684, lng: 105.99346928371303},
          {lat: 19.819682361703254, lng: 105.76770166633268},
          {lat: 18.711456424601646, lng: 105.66234345655316},
          {lat: 18.354691459788658, lng: 105.86553435239364},
          {lat: 16.805138871574268, lng: 107.07715392917399},]
      },
      {
        id: 3,
        path: [{lat: 18.711456424601646, lng: 105.66234345655316},
          {lat: 18.354691459788658, lng: 105.86553435239364},
          {lat: 16.805138871574268, lng: 107.07715392917399},
          {lat: 16.58167781786605, lng: 107.65662418622229},
          {lat: 16.126750114098915, lng: 108.27017603763079},
          {lat: 15.567281788071831, lng: 108.48102833156065},
          {lat: 15.141416938436706, lng: 108.80816105289705},
          {lat: 13.994761407572653, lng: 108.03098465823884},
          {lat: 11.952749047011816, lng: 108.44108838127723},
          {lat: 10.83681587422422, lng: 106.69123984794433},]
      },
      {
        id: 4,
        path: [
          {lat: 16.58167781786605, lng: 107.65662418622229},
          {lat: 16.126750114098915, lng: 108.27017603763079},
          {lat: 15.567281788071831, lng: 108.48102833156065},
          {lat: 15.141416938436706, lng: 108.80816105289705},
          {lat: 13.994761407572653, lng: 108.03098465823884},
          {lat: 11.952749047011816, lng: 108.44108838127723},
          {lat: 10.83681587422422, lng: 106.69123984794433},
          {lat: 18.711456424601646, lng: 105.66234345655316},
          {lat: 18.354691459788658, lng: 105.86553435239364},
          {lat: 16.805138871574268, lng: 107.07715392917399},
          {lat: 16.58167781786605, lng: 107.65662418622229}]
      },
      {
        id: 4,
        path: [
          {lat: 16.58167781786605, lng: 107.65662418622229},
          {lat: 16.126750114098915, lng: 108.27017603763079},
          {lat: 15.567281788071831, lng: 108.48102833156065},
          {lat: 15.141416938436706, lng: 108.80816105289705},
          {lat: 13.994761407572653, lng: 108.03098465823884},
          {lat: 11.952749047011816, lng: 108.44108838127723},
          {lat: 10.83681587422422, lng: 106.69123984794433},
          {lat: 18.711456424601646, lng: 105.66234345655316},
          {lat: 18.354691459788658, lng: 105.86553435239364},
          {lat: 16.805138871574268, lng: 107.07715392917399},
          {lat: 16.58167781786605, lng: 107.65662418622229}]
      },
      {
        id: 5,
        path: [
          {lat: 16.58167781786605, lng: 107.65662418622229},
          {lat: 15.141416938436706, lng: 108.80816105289705},
          {lat: 13.994761407572653, lng: 108.03098465823884},
          {lat: 11.952749047011816, lng: 108.44108838127723},
          {lat: 16.126750114098915, lng: 108.27017603763079},
          {lat: 15.567281788071831, lng: 108.48102833156065},
          {lat: 18.354691459788658, lng: 105.86553435239364},
          {lat: 16.805138871574268, lng: 107.07715392917399},
          {lat: 10.83681587422422, lng: 106.69123984794433},
          {lat: 18.711456424601646, lng: 105.66234345655316},
          {lat: 16.58167781786605, lng: 107.65662418622229}]
      },
      {
        id: 6,
        path: [
          {lat: 16.58167781786605, lng: 107.65662418622229},
          {lat: 10.83681587422422, lng: 106.69123984794433},
          {lat: 18.711456424601646, lng: 105.66234345655316},
          {lat: 15.141416938436706, lng: 108.80816105289705},
          {lat: 13.994761407572653, lng: 108.03098465823884},
          {lat: 11.952749047011816, lng: 108.44108838127723},
          {lat: 16.126750114098915, lng: 108.27017603763079},
          {lat: 15.567281788071831, lng: 108.48102833156065},
          {lat: 18.354691459788658, lng: 105.86553435239364},
          {lat: 16.805138871574268, lng: 107.07715392917399},
          {lat: 16.58167781786605, lng: 107.65662418622229}]
      },
      {
        id: 6,
        path: [
          {lat: 16.58167781786605, lng: 107.65662418622229},
          {lat: 10.83681587422422, lng: 106.69123984794433},
          {lat: 18.711456424601646, lng: 105.66234345655316},
          {lat: 15.141416938436706, lng: 108.80816105289705},
          {lat: 13.994761407572653, lng: 108.03098465823884},
          {lat: 11.952749047011816, lng: 108.44108838127723},
          {lat: 16.126750114098915, lng: 108.27017603763079},
          {lat: 15.567281788071831, lng: 108.48102833156065},
          {lat: 18.354691459788658, lng: 105.86553435239364},
          {lat: 16.805138871574268, lng: 107.07715392917399},
          {lat: 16.58167781786605, lng: 107.65662418622229}]
      },
      {
        id: 7,
        path: [
          {lat: 20.922916609579897, lng: 108.43498103395416},
          {lat: 18.951650471102848, lng: 107.94000269804293},
          {lat: 18.33473048777155, lng: 107.79057273732471},
          {lat: 16.777797718266946, lng: 109.12476881516595},
          {lat: 15.794265162856211, lng: 113.19139846042609},
          {lat: 19.86410338612458, lng: 115.1392615908026},
          {lat: 17.374296746656004, lng: 115.16026379894471},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 20.71562431957068, lng: 112.66607961975872},
          {lat: 12.34063823227273, lng: 111.12799376600722},
          {lat: 15.750589497223569, lng: 117.36822780122753},
          {lat: 11.461025216040964, lng: 116.73070318363312},
          {lat: 11.309739623355329, lng: 114.55163483350081},
          {lat: 12.242217766977152, lng: 111.17883295633081},
          {lat: 12.770564607512977, lng: 103.64082494054053},
          {lat: 16.991153979102528, lng: 109.63257490180972},
          {lat: 23.265317050949125, lng: 122.83176987619161},
          {lat: 15.249740795480067, lng: 125.89890653630825},
          {lat: 8.966321728597876, lng: 119.6907263086023},
          {lat: 8.710719442890113, lng: 109.12203854000762},
          {lat: 20.922916609579897, lng: 108.43498103395416},
        ]
      },
      {
        id: 8,
        path: [
          {lat: 18.951650471102848, lng: 107.94000269804293},
          {lat: 18.33473048777155, lng: 107.79057273732471},
          {lat: 16.777797718266946, lng: 109.12476881516595},
          {lat: 15.794265162856211, lng: 113.19139846042609},
          {lat: 19.86410338612458, lng: 115.1392615908026},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 20.71562431957068, lng: 112.66607961975872},
          {lat: 12.34063823227273, lng: 111.12799376600722},
          {lat: 15.750589497223569, lng: 117.36822780122753},
          {lat: 11.461025216040964, lng: 116.73070318363312},
          {lat: 11.309739623355329, lng: 114.55163483350081},
          {lat: 12.242217766977152, lng: 111.17883295633081},
          {lat: 12.770564607512977, lng: 103.64082494054053},
          {lat: 16.991153979102528, lng: 109.63257490180972},
          {lat: 23.265317050949125, lng: 122.83176987619161},
          {lat: 17.374296746656004, lng: 115.16026379894471},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 20.922916609579897, lng: 108.43498103395416},
          {lat: 18.951650471102848, lng: 107.94000269804293},
        ]
      },
      {
        id: 9,
        path: [
          {lat: 18.951650471102848, lng: 107.94000269804293},
          {lat: 18.33473048777155, lng: 107.79057273732471},
          {lat: 16.777797718266946, lng: 109.12476881516595},
          {lat: 15.794265162856211, lng: 113.19139846042609},
          {lat: 23.265317050949125, lng: 122.83176987619161},
          {lat: 17.374296746656004, lng: 115.16026379894471},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 11.461025216040964, lng: 116.73070318363312},
          {lat: 11.309739623355329, lng: 114.55163483350081},
          {lat: 12.242217766977152, lng: 111.17883295633081},
          {lat: 12.770564607512977, lng: 103.64082494054053},
          {lat: 16.991153979102528, lng: 109.63257490180972},
          {lat: 19.86410338612458, lng: 115.1392615908026},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 20.71562431957068, lng: 112.66607961975872},
          {lat: 12.34063823227273, lng: 111.12799376600722},
          {lat: 15.750589497223569, lng: 117.36822780122753},
          {lat: 23.265317050949125, lng: 122.83176987619161},
          {lat: 17.374296746656004, lng: 115.16026379894471},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 20.922916609579897, lng: 108.43498103395416},
          {lat: 18.951650471102848, lng: 107.94000269804293},
        ]
      },
      {
        id: 10,
        path: [
          {lat: 18.951650471102848, lng: 107.94000269804293},
          {lat: 18.33473048777155, lng: 107.79057273732471},
          {lat: 16.777797718266946, lng: 109.12476881516595},
          {lat: 15.794265162856211, lng: 113.19139846042609},
          {lat: 12.34063823227273, lng: 111.12799376600722},
          {lat: 15.750589497223569, lng: 117.36822780122753},
          {lat: 23.265317050949125, lng: 122.83176987619161},
          {lat: 17.374296746656004, lng: 115.16026379894471},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 19.86410338612458, lng: 115.1392615908026},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 20.71562431957068, lng: 112.66607961975872},
          {lat: 23.265317050949125, lng: 122.83176987619161},
          {lat: 17.374296746656004, lng: 115.16026379894471},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 11.461025216040964, lng: 116.73070318363312},
          {lat: 11.309739623355329, lng: 114.55163483350081},
          {lat: 12.242217766977152, lng: 111.17883295633081},
          {lat: 12.770564607512977, lng: 103.64082494054053},
          {lat: 16.991153979102528, lng: 109.63257490180972},
          {lat: 19.86410338612458, lng: 115.1392615908026},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 20.71562431957068, lng: 112.66607961975872},
          {lat: 12.34063823227273, lng: 111.12799376600722},
          {lat: 15.750589497223569, lng: 117.36822780122753},
          {lat: 23.265317050949125, lng: 122.83176987619161},
          {lat: 17.374296746656004, lng: 115.16026379894471},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 20.922916609579897, lng: 108.43498103395416},
          {lat: 18.951650471102848, lng: 107.94000269804293},
        ]
      },
      {
        id: 10,
        path: [
          {lat: 18.951650471102848, lng: 107.94000269804293},
          {lat: 18.33473048777155, lng: 107.79057273732471},
          {lat: 16.777797718266946, lng: 109.12476881516595},
          {lat: 15.794265162856211, lng: 113.19139846042609},
          {lat: 12.34063823227273, lng: 111.12799376600722},
          {lat: 15.750589497223569, lng: 117.36822780122753},
          {lat: 23.265317050949125, lng: 122.83176987619161},
          {lat: 17.374296746656004, lng: 115.16026379894471},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 23.265317050949125, lng: 122.83176987619161},
          {lat: 17.374296746656004, lng: 115.16026379894471},
          {lat: 19.86410338612458, lng: 115.1392615908026},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 20.71562431957068, lng: 112.66607961975872},
          {lat: 23.265317050949125, lng: 122.83176987619161},
          {lat: 17.374296746656004, lng: 115.16026379894471},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 11.461025216040964, lng: 116.73070318363312},
          {lat: 11.309739623355329, lng: 114.55163483350081},
          {lat: 19.86410338612458, lng: 115.1392615908026},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 20.71562431957068, lng: 112.66607961975872},
          {lat: 12.34063823227273, lng: 111.12799376600722},
          {lat: 15.750589497223569, lng: 117.36822780122753},
          {lat: 12.242217766977152, lng: 111.17883295633081},
          {lat: 12.770564607512977, lng: 103.64082494054053},
          {lat: 16.991153979102528, lng: 109.63257490180972},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 20.922916609579897, lng: 108.43498103395416},
          {lat: 18.951650471102848, lng: 107.94000269804293},
        ]
      },
      {
        id: 10,
        path: [
          {lat: 18.951650471102848, lng: 107.94000269804293},
          {lat: 18.33473048777155, lng: 107.79057273732471},
          {lat: 16.777797718266946, lng: 109.12476881516595},
          {lat: 15.794265162856211, lng: 113.19139846042609},
          {lat: 19.86410338612458, lng: 115.1392615908026},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 20.71562431957068, lng: 112.66607961975872},
          {lat: 12.34063823227273, lng: 111.12799376600722},
          {lat: 15.750589497223569, lng: 117.36822780122753},
          {lat: 12.242217766977152, lng: 111.17883295633081},
          {lat: 23.265317050949125, lng: 122.83176987619161},
          {lat: 17.374296746656004, lng: 115.16026379894471},
          {lat: 19.86410338612458, lng: 115.1392615908026},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 20.71562431957068, lng: 112.66607961975872},
          {lat: 23.265317050949125, lng: 122.83176987619161},
          {lat: 17.374296746656004, lng: 115.16026379894471},
          {lat: 12.34063823227273, lng: 111.12799376600722},
          {lat: 15.750589497223569, lng: 117.36822780122753},
          {lat: 23.265317050949125, lng: 122.83176987619161},
          {lat: 17.374296746656004, lng: 115.16026379894471},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 11.461025216040964, lng: 116.73070318363312},
          {lat: 11.309739623355329, lng: 114.55163483350081},
          {lat: 12.770564607512977, lng: 103.64082494054053},
          {lat: 16.991153979102528, lng: 109.63257490180972},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 20.922916609579897, lng: 108.43498103395416},
          {lat: 18.951650471102848, lng: 107.94000269804293},
        ]
      },
      {
        id: 11,
        path: [
          {lat: 18.33473048777155, lng: 107.79057273732471},
          {lat: 16.777797718266946, lng: 109.12476881516595},
          {lat: 15.794265162856211, lng: 113.19139846042609},
          {lat: 19.86410338612458, lng: 115.1392615908026},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 20.71562431957068, lng: 112.66607961975872},
          {lat: 12.34063823227273, lng: 111.12799376600722},
          {lat: 15.750589497223569, lng: 117.36822780122753},
          {lat: 12.242217766977152, lng: 111.17883295633081},
          {lat: 23.265317050949125, lng: 122.83176987619161},
          {lat: 17.374296746656004, lng: 115.16026379894471},
          {lat: 19.86410338612458, lng: 115.1392615908026},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 20.71562431957068, lng: 112.66607961975872},
          {lat: 23.265317050949125, lng: 122.83176987619161},
          {lat: 17.374296746656004, lng: 115.16026379894471},
          {lat: 12.34063823227273, lng: 111.12799376600722},
          {lat: 15.750589497223569, lng: 117.36822780122753},
          {lat: 23.265317050949125, lng: 122.83176987619161},
          {lat: 17.374296746656004, lng: 115.16026379894471},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 11.461025216040964, lng: 116.73070318363312},
          {lat: 11.309739623355329, lng: 114.55163483350081},
          {lat: 12.770564607512977, lng: 103.64082494054053},
          {lat: 16.991153979102528, lng: 109.63257490180972},
          {lat: 15.148953146864079, lng: 112.48113756964749},
          {lat: 20.922916609579897, lng: 108.43498103395416},
          {lat: 18.951650471102848, lng: 107.94000269804293},
          {lat: 18.951650471102848, lng: 107.94000269804293},
          {lat: 18.33473048777155, lng: 107.79057273732471}
        ]
      }]


    paths.forEach(item => {
      this.polylineOptionsList.push({...polylineOptionsCore, path: item.path})
    })


    let count = 0;
    setInterval(() => {
      count = (count + 1) % 200;
      this.polylineOptionsList = this.polylineOptionsList.map(item => {
        return {
          ...item,
          icons: [{offset: count / 2 + "%", icon: svgMarker}]
        }
      })
    }, 20);
  }


  ngOnInit()
    :
    void {
    // setInterval(  this._loadMarket();, 1000);
  }

  moveMap(event
            :
            google.maps.MapMouseEvent
  ) {
    // @ts-ignore
    this.center = (event.latLng.toJSON());
  }

  move(event
         :
         google.maps.MapMouseEvent
  ) {
    // @ts-ignore
    this.display = event.latLng.toJSON();
  }

  ngOnDestroy() {

  }
}
